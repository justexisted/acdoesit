<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AI Prompt Builder — AC Does It</title>
    <link rel="stylesheet" href="../styles.css">
    <!-- Google Sign-In API -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
      .prompt-builder-wrap{min-height:100vh;display:flex;align-items:flex-start;padding-top:40px}
      .module-picker{display:grid;gap:12px;margin-bottom:24px}
      @media (min-width:780px){.module-picker{grid-template-columns:repeat(5,1fr)}}
      .module-btn{background:var(--surface-2);border:2px solid var(--ring);border-radius:8px;padding:16px;text-align:center;cursor:pointer;transition:all 0.2s}
      .module-btn:hover{border-color:var(--accent);background:var(--accent);color:var(--accent-ink)}
      .module-btn.active{border-color:var(--accent);background:var(--accent);color:var(--accent-ink)}
      .module-form{display:grid;gap:16px;margin-bottom:24px}
      @media (min-width:780px){.module-form{grid-template-columns:repeat(2,1fr)}}
      @media (min-width:1200px){.module-form{grid-template-columns:repeat(3,1fr)}}
      .field{display:flex;flex-direction:column;gap:6px}
      .field span{font-weight:600;font-size:0.9rem}
      .field input,.field select,.field textarea{padding:8px 12px;border:1px solid #e5e7eb;border-radius:6px;font-size:0.9rem}
      .field textarea{min-height:80px;resize:vertical}
      .field select[multiple]{min-height:100px}
      .field.checkboxes,.field.multiselect{grid-column:1/-1}
      .field.checkboxes legend,.field.multiselect span{font-weight:600;font-size:0.9rem;margin-bottom:8px}
      .field.checkboxes label{display:flex;align-items:center;gap:8px;margin-bottom:6px;font-size:0.9rem}
      .field.checkboxes input[type="checkbox"]{width:auto;margin:0}
      
      /* Custom checkbox styling for better appearance */
      .checkbox-label{display:flex;align-items:center;gap:8px;margin-bottom:8px;cursor:pointer}
      .checkbox-label input[type="checkbox"]{appearance:none;width:20px;height:20px;border:2px solid #d1d5db;border-radius:4px;display:flex;align-items:center;justify-content:center;background:#fff;cursor:pointer;transition:all 0.2s ease;position:relative}
      .checkbox-label input[type="checkbox"]:checked{background:#064591;border-color:#064591}
      .checkbox-label input[type="checkbox"]:checked::after{content:"✓";color:#fff;font-size:16px;font-weight:bold;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);line-height:1}
      .checkbox-label input[type="checkbox"]:hover{border-color:#064591}
      .checkbox-text{font-size:0.9rem;user-select:none}
      
      /* Combobox styling */
      .combobox-container{position:relative}
      .combobox-container input{width:100%;padding:8px 12px;border:1px solid #e5e7eb;border-radius:6px;font-size:0.9rem}
      .combobox-container input:focus{outline:none;border-color:#064591;box-shadow:0 0 0 3px rgba(6, 69, 145, 0.1)}
      
      /* Template selector styling */
      .template-selector{margin-top:20px;padding:16px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px}
      .template-selector h3{margin:0 0 12px 0;font-size:1.1rem;color:var(--accent)}
      .template-buttons{display:flex;gap:8px;flex-wrap:wrap}
      .template-btn{padding:8px 16px;border:1px solid #d1d5db;border-radius:6px;background:#fff;cursor:pointer;transition:all 0.2s ease;font-size:0.9rem}
      .template-btn:hover{border-color:#064591;background:#f0f4ff}
      .template-btn.active{border-color:#064591;background:#064591;color:#fff}
      
      .actions{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:24px}
      .preview{background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px;padding:16px;white-space:pre-wrap;font-family:monospace;font-size:0.9rem;line-height:1.5;max-height:400px;overflow-y:auto}
      .error{color:var(--bad);font-size:0.8rem;margin-top:4px}
      .required::after{content:" *";color:var(--bad)}
      .suffix{position:relative}
      .suffix input{padding-right:40px}
      .suffix::after{content:attr(data-suffix);position:absolute;right:12px;top:50%;transform:translateY(-50%);color:var(--muted);font-size:0.8rem}
    </style>
  </head>
  <body>
    <!-- Authentication Check -->
    <div id="auth-required" style="display: none; min-height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--bg);">
      <div style="text-align: center; max-width: 500px; padding: 40px;">
        <h1 style="color: var(--accent); margin-bottom: 16px;">Authentication Required</h1>
        <p style="color: var(--muted); margin-bottom: 24px;">You need to sign up or sign in to access the AI Prompt Builder.</p>
        <div style="display: flex; gap: 12px; justify-content: center;">
          <a href="../contact.html" class="btn btn-accent">Sign Up for Free Access</a>
          <a href="../index.html" class="btn">Back to Home</a>
        </div>
      </div>
    </div>

    <div id="app-content" style="display: none;">
      <header class="page-header">
        <div class="header-content">
          <div class="header-logo">
            <img src="../assets/newlogo.png" alt="AC Does It">
            <span class="brand-text">AC Does It</span>
          </div>
          <div class="nav-row">
            <a class="btn" href="../index.html">← Back to site</a>
            <div style="display: flex; align-items: center; gap: 12px;">
              <span id="user-welcome" style="color: var(--muted); font-size: 0.9rem;"></span>
              <button onclick="signOut()" class="btn" style="padding: 6px 12px; font-size: 0.9rem;">Sign Out</button>
            </div>
          </div>
        </div>
      </header>
    
    <main class="section prompt-builder-wrap">
      <div class="container" style="width:min(1200px,100% - 24px)">
        <h1 style="font-size:clamp(1.4rem,4vw,2rem);margin-bottom:10px">AI Prompt Builder</h1>
        <p class="subhead">Generate professional AI prompts for San Diego real estate</p>

        <!-- Module Picker -->
        <div id="module-picker" class="module-picker">
          <button class="module-btn active" data-module="listing">
            <strong>Property Listing</strong>
            <div style="font-size:0.8rem;margin-top:4px">Generate SEO-friendly MLS descriptions</div>
          </button>
          <button class="module-btn" data-module="investment">
            <strong>Investment Analysis</strong>
            <div style="font-size:0.8rem;margin-top:4px">Quick financial viability check</div>
          </button>
          <button class="module-btn" data-module="zoning">
            <strong>Zoning & Feasibility</strong>
            <div style="font-size:0.8rem;margin-top:4px">SD Municipal Code analysis</div>
          </button>
          <button class="module-btn" data-module="staging">
            <strong>Staging Plan</strong>
            <div style="font-size:0.8rem;margin-top:4px">Room-by-room staging strategy</div>
          </button>
          <button class="module-btn" data-module="calendar">
            <strong>Content Calendar</strong>
            <div style="font-size:0.8rem;margin-top:4px">Monthly social media posts</div>
          </button>
        </div>

        <!-- Dynamic Form -->
        <form id="module-form" class="module-form"></form>

        <!-- Template Selection (for Property Listing) -->
        <div id="template-selector" class="template-selector" style="display:none;margin-top:16px;">
          <h3 style="margin-bottom:12px">Choose Template Style:</h3>
          <div class="template-buttons">
            <button class="template-btn active" data-template="full">Full Description</button>
            <button class="template-btn" data-template="zillow">Zillow (Concise)</button>
            <button class="template-btn" data-template="instagram">Instagram (Social)</button>
          </div>
        </div>

        <!-- Actions -->
        <div class="actions">
          <button id="generate-btn" class="btn btn-accent">Generate Prompt</button>
          <button id="copy-btn" class="btn">Copy to Clipboard</button>
          <button id="save-btn" class="btn">Save to Account</button>
        </div>

        <!-- Preview -->
        <div id="preview-container" style="display:none">
          <h3>Generated Prompt:</h3>
          <pre id="preview" class="preview"></pre>
        </div>
      </div>
    </main>
    </div>

    <script src="../auth.js" defer></script>
    <script>
      // Authentication check for AI Prompt Builder
      let authSystem;
      
      // Function to check authentication and show appropriate content
      function checkAuthAndShowContent() {
        const authRequired = document.getElementById('auth-required');
        const appContent = document.getElementById('app-content');
        const userWelcome = document.getElementById('user-welcome');
        
        // Get current user from localStorage
        const savedUser = localStorage.getItem('currentUser');
        
        if (savedUser) {
          try {
            const user = JSON.parse(savedUser);
            // User is authenticated, show the app
            authRequired.style.display = 'none';
            appContent.style.display = 'block';
            if (userWelcome) {
              userWelcome.textContent = `Welcome, ${user.firstName}!`;
            }
          } catch (error) {
            // Invalid user data, show auth required
            localStorage.removeItem('currentUser');
            authRequired.style.display = 'flex';
            appContent.style.display = 'none';
          }
        } else {
          // No user, show auth required
          authRequired.style.display = 'flex';
          appContent.style.display = 'none';
        }
      }
      
      // Sign out function
      function signOut() {
        localStorage.removeItem('currentUser');
        alert('You have been signed out.');
        window.location.href = '../index.html';
      }
      
      // Check authentication when page loads
      document.addEventListener('DOMContentLoaded', () => {
        checkAuthAndShowContent();
      });
      
      // Listen for authentication events
      window.addEventListener('userSignedIn', () => {
        checkAuthAndShowContent();
      });
      
      window.addEventListener('userSignedOut', () => {
        checkAuthAndShowContent();
      });
    </script>
    <script src="./ai-prompt-builder.js" defer></script>
  </body>
</html>
