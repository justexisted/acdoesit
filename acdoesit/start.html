<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Start — What do you want most?</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <main class="section step" style="min-height:100vh;display:flex;align-items:center;">
      <div class="container" style="width:min(800px,100% - 24px);">
        <div id="reset-box" style="display:none;background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin-bottom:16px;">
          <h2 style="margin:0 0 8px 0;">Reset your password</h2>
          <p style="margin:0 0 12px 0;">Enter a new password below.</p>
          <div class="form-group">
            <label for="newPassword">New Password</label>
            <input type="password" id="newPassword" minlength="6" />
          </div>
          <button id="confirmResetBtn" class="btn btn-accent">Confirm Reset</button>
        </div>
        <div class="nav-row">
          <a id="back" class="btn" href="index.html">← Back</a>
          <a id="next" class="btn btn-accent" href="role.html">Next →</a>
        </div>
        <h1 style="font-size:clamp(1.6rem,6vw,2.4rem);margin-bottom:18px">What do you want most?</h1>
        <div class="options" style="display:grid;gap:12px;">
          <a class="btn btn-accent btn-lg" href="role.html?want=Get%20more%20people%20interested">Get more people interested</a>
          <a class="btn btn-accent btn-lg" href="role.html?want=Get%20more%20people%20to%20buy">Get more people to buy</a>
          <a class="btn btn-accent btn-lg" href="role.html?want=Get%20people%20talking%20about%20my%20stuff">Get people talking about my stuff</a>
          <a class="btn btn-accent btn-lg" href="role.html?want=All%20of%20these!">All of these!</a>
        </div>
      </div>
    </main>
    <script>
      // Build next/back with existing params
      (function(){
        const params = new URLSearchParams(window.location.search);
        const back = document.getElementById('back');
        const next = document.getElementById('next');
        if (back) {
          const b = new URL(back.getAttribute('href'), window.location.origin);
          b.search = '?' + params.toString();
          back.setAttribute('href', b.pathname + b.search);
        }
        if (next) {
          const n = new URL(next.getAttribute('href'), window.location.origin);
          n.search = '?' + params.toString();
          next.setAttribute('href', n.pathname + n.search);
        }
      })();

      // Handle #reset=token in hash
      (function(){
        const hash = window.location.hash || '';
        const m = hash.match(/reset=([A-Za-z0-9]+)/);
        if (m) {
          const token = m[1];
          const box = document.getElementById('reset-box');
          if (box) box.style.display = 'block';
          const btn = document.getElementById('confirmResetBtn');
          btn && btn.addEventListener('click', async () => {
            const pw = document.getElementById('newPassword').value;
            if (!pw || pw.length < 6) { alert('Password must be at least 6 characters'); return; }
            try {
              const resp = await fetch('/.netlify/functions/confirm-password-reset', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token, newPassword: pw })
              });
              if (!resp.ok) { const t = await resp.text(); throw new Error(t || 'Reset failed'); }
              alert('Password updated. You can now sign in.');
              window.location.hash = '';
              window.location.href = 'index.html#signin';
            } catch (e) {
              alert('Reset failed: ' + e.message);
            }
          });
        }
      })();
    </script>
  </body>
  </html>


